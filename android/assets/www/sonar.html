<!DOCTYPE html>

<html>
<meta charset='utf-8' />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<head>

<title>真太阳时</title>


<style type="text/css">
body {
	font: Helvetica, arial, freesans, clean, sans-serif 13px;
	background-color: #245aa6;
}

#main {
	background-color: #245aa6;
	color: #fff;
}

a {
	color: yellow;
	text-decoration: none;
}

h1 {
	text-align: center;
}
</style>

<script type="text/javascript">
	var timer;
	function getRealOffset(){
		var today = new Date();
		var mon = today.getMonth();
		mon++;
		mon = mon+1<=10?'0'+mon:mon;
		var d = today.getDate();
		d = d < 10 ? '0' + d : d;
		var key = mon+'/'+d;
		//console.log('real offset key is '+key);
		var val = realSonarOffsetMap[key];//+15'22"
		
		//console.log('real offset value is '+val);
		if(!val){
			return -15 * 60 * 1000;//default to 15 mins.			
		}
		var isPositive = val.substring(0, 1)=='+'?true:false;
		var minutes = val.substring(1, val.indexOf('\''));
		var seconds = val.substring(val.indexOf('\'')+1, val.indexOf('\"'));
		//console.log('mis: '+minutes+' secs: '+seconds);
		var resultVal = (parseInt(minutes) * 60 + parseInt(seconds)) * 1000;
		if(isPositive){
			return resultVal;
		}else{
			return -resultVal;
		}
		
	}
	function displayTime() {
		if (window.geoPos) {
			var latiOffset = geoPos.coords.longitude * 4 * 60 * 1000;
			var realOffset = getRealOffset();
			var realTime = new Date(new Date(
					new Date().toGMTString().substring(0,
							new Date().toGMTString().lastIndexOf(" ") + 1))
					.getTime()
					+ latiOffset + realOffset);
			var mon = realTime.getMonth();
			mon++;
			mon = mon < 10 ? '0' + mon : mon;
			var d = realTime.getDate();
			d = d < 10 ? '0' + d : d;
			var h = realTime.getHours();
			h = h < 10 ? '0' + h : h;
			var m = realTime.getMinutes();
			m = m < 10 ? '0' + m : m;
			var s = realTime.getSeconds();
			s = s < 10 ? '0' + s : s;
			document.getElementById('currentTime').innerHTML = realTime
					.getFullYear()
					+ '-' + mon + '-' + d + ' ' + h + ':' + m + ':' + s
		} else {

		}
	}
	function clearTimer(){
		if(timer){
			clearTimeout(timer);
		}
		
	}
	function showClock() {
		clearTimer();
		
		displayTime();
		
		timer = setTimeout(function() {
			showClock();
		}, 1000);

	}

	var map;
	var geocoder;
	function initPosition(position){
		clearTimer();
		window.geoPos = position;
		
		showClock();
		alert(position['coords']['addr']);
		document.getElementById('address').innerHTML = position['coords']['addr'];
		document.getElementById('location').innerHTML = position['coords']['latitude']+','+position['coords']['longitude'] 
		
		/*

		var latlng = new google.maps.LatLng(position.coords.latitude,
				position.coords.longitude);
		var mapOptions = {
			zoom : 14,
			center : latlng,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		}
		map = new google.maps.Map(
				document.getElementById("map_canvas"), mapOptions);
		
		geocoder = new google.maps.Geocoder();
		geocoder.geocode({'latLng': latlng}, function(results, status) {
			  if (status == google.maps.GeocoderStatus.OK) {
			    if (results[1]) {
			      map.setZoom(14);
			      marker = new google.maps.Marker({
			          position: latlng, 
			          map: map
			      }); 
			      var addr = results[1].formatted_address;
			      //infowindow.open(map, marker);
			      var marker = new google.maps.Marker({
						position : latlng,
						map : map,
						title : addr
					});
			      var infowindow = new google.maps.InfoWindow({
			          content: '<span style="color: black">'+addr+'</span>'
			      });
			      infowindow.open(map, marker);
			      
			      document.getElementById('address').innerHTML = addr;
			    } else {
			    	if(typeof(console)!=undefined && console && console.log){
						console.log('Not found.');	  
					  }
			    }
			  } else {
				  if(typeof(console)!=undefined && console && console.log){
					console.log('Not found.');	  
				  }
			    
			  }
			});

		*/
		
	}
	function initialize() {
		detectBrowser();
		
		/*
		if (navigator.geolocation) {

			navigator.geolocation.getCurrentPosition(function(position) {
				initPosition(position);
			}, function(){
				document.getElementById('error').style.display='inline';
			}

			);

		} else {
			document.getElementById('error').style.display='inline';
		}*/
	}


	
	function detectBrowser() {
		  var useragent = navigator.userAgent;
		  var mapdiv = document.getElementById("map_canvas");

		  if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
		    mapdiv.style.width = '100%';
		    mapdiv.style.height = '250px';
		  }
		}


</script>


</head>

<body onload="initialize()">

	<div id="main" align="center">
		<h1>您當前位置的真太陽時</h1>
		<!--  <h1>test</h1>-->
		<h1>
			<span id="currentTime">00:00:00</span>
		</h1>
		
		<!--  <form action="#"
			onsubmit="initPosition({'coords':{'latitude':document.forms[0].lati.value,'longitude':document.forms[0].longi.value}}); return false;">
			<p id='manualInputForm' >
				<b id="error" style="display:none;">自動定位失敗，請</b><b>手動輸入位置:</b> <b>緯度</b><input type="text" name="lati"
					value="" class="address_input" size="10" /> <b>經度</b><input
					type="text" name="longi" value="" class="address_input" size="10" />
				<input type="submit" name="find" value="確定" />

			</p>
		</form>
		<div id="map_canvas" style="width: 500px; height: 300px"></div>
		-->
		

		<p>您的位置: <span id="address">未知</span>.</p>
		<p>經緯度: <span id="location">未知</span>.<p>

	</div>
</body>
<footer>
<center><p>計算方式遵循<a href="http://www.duosuccess.com">多成中醫</a>的<a href="http://www.duosuccess.com/tcm/004a05061109o.htm">真太陽時說明</a></p></center>
<p>聯繫方式<a href="mailto:racke1983cn@gmail.com?Subject=真太陽時">&nbsp racke1983cn@gmail.com</a>
<p></p>
</footer>
<script>
var realSonarOffsetMap = 
{
		"01/01":"-3\'09\"",
		"01/02":"-3\'38\"",
		"01/03":"-4\'06\"",
		"01/04":"-4\'33\"",
		"01/05":"-5\'01\"",
		"01/06":"-5\'27\"",
		"01/07":"-5\'54\"",
		"01/08":"-6\'20\"",
		"01/09":"-6\'45\"",
		"01/10":"-7\'10\"",
		"01/11":"-7\'35\"",
		"01/12":"-7\'59\"",
		"01/13":"-8\'22\"",
		"01/14":"-8\'45\"",
		"01/15":"-9\'07\"",
		"01/16":"-9\'28\"",
		"01/17":"-9\'49\"",
		"01/18":"-10\'09\"",
		"01/19":"-10\'28\"",
		"01/20":"-10\'47\"",
		"01/21":"-11\'05\"",
		"01/22":"-11\'22\"",
		"01/23":"-11\'38\"",
		"01/24":"-11\'54\"",
		"01/25":"-12\'08\"",
		"01/26":"-12\'22\"",
		"01/27":"-12\'35\"",
		"01/28":"-12\'59\"",
		"01/29":"-13\'10\"",
		"01/30":"-13\'19\"",
		"01/31":"-13\'37\"",
		"02/01":"-13\'44\"",
		"02/02":"-13\'50\"",
		"02/03":"-13\'56\"",
		"02/04":"-14\'01\"",
		"02/05":"-14\'05\"",
		"02/06":"-14\'09\"",
		"02/07":"-14\'11\"",
		"02/08":"-14\'13\"",
		"02/09":"-14\'14\"",
		"02/10":"-14\'15\"",
		"02/11":"-14\'14\"",
		"02/12":"-14\'13\"",
		"02/13":"-14\'11\"",
		"02/14":"-14\'08\"",
		"02/15":"-14\'05\"",
		"02/16":"-14\'01\"",
		"02/17":"-13\'56\"",
		"02/18":"-13\'51\"",
		"02/19":"-13\'44\"",
		"02/20":"-13\'38\"",
		"02/21":"-13\'30\"",
		"02/22":"-13\'22\"",
		"02/23":"-13\'13\"",
		"02/24":"-11\'04\"",
		"02/25":"-12\'54\"",
		"02/26":"-12\'43\"",
		"02/27":"-12\'32\"",
		"02/28":"-12\'21\"",
		"02/29":"-12\'08\"",
		"03/01":"-11\'56\"",
		"03/02":"-11\'43\"",
		"03/03":"-11\'29\"",
		"03/04":"-11\'15\"",
		"03/05":"-11\'01\"",
		"03/06":"-10\'47\"",
		"03/07":"-10\'32\"",
		"03/08":"-10\'16\"",
		"03/09":"-10\'01\"",
		"03/10":"-9\'45\"",
		"03/11":"-9\'28\"",
		"03/12":"-9\'12\"",
		"03/13":"-8\'55\"",
		"03/14":"-8\'38\"",
		"03/15":"-8\'21\"",
		"03/16":"-8\'04\"",
		"03/17":"-7\'46\"",
		"03/18":"-7\'29\"",
		"03/19":"-7\'11\"",
		"03/20":"-6\'53\"",
		"03/21":"-6\'35\"",
		"03/22":"-6\'17\"",
		"03/23":"-5\'58\"",
		"03/24":"-5\'40\"",
		"03/25":"-5\'22\"",
		"03/26":"-5\'04\"",
		"03/27":"-4\'45\"",
		"03/28":"-4\'27\"",
		"03/29":"-4\'09\"",
		"03/30":"-3\'51\"",
		"03/31":"-3\'33\"",
		"04/01":"-3\'16\"",
		"04/02":"-2\'58\"",
		"04/03":"-2\'41\"",
		"04/04":"-2\'24\"",
		"04/05":"-2\'07\"",
		"04/06":"-1\'50\"",
		"04/07":"-1\'33\"",
		"04/08":"-1\'17\"",
		"04/09":"-1\'01\"",
		"04/10":"+0\'46\"",
		"04/11":"+0\'30\"",
		"04/12":"+0\'16\"",
		"04/13":"+0\'01\"",
		"04/14":"+0\'13\"",
		"04/15":"+0\'27\"",
		"04/16":"+0\'41\"",
		"04/17":"+0\'54\"",
		"04/18":"+1\'06\"",
		"04/19":"+1\'19\"",
		"04/20":"+1\'31\"",
		"04/21":"+1\'42\"",
		"04/22":"+1\'53\"",
		"04/23":"+2\'04\"",
		"04/24":"+2\'14\"",
		"04/25":"+2\'23\"",
		"04/26":"+2\'33\"",
		"04/27":"+2\'41\"",
		"04/28":"+2\'49\"",
		"04/29":"+2\'57\"",
		"04/30":"+3\'04\"",
		"05/01":"+1\'10\"",
		"05/02":"+3\'16\"",
		"05/03":"+3\'21\"",
		"05/04":"+3\'26\"",
		"05/05":"+3\'30\"",
		"05/06":"+3\'37\"",
		"05/07":"+3\'36\"",
		"05/08":"+3\'39\"",
		"05/09":"+3\'40\"",
		"05/10":"+3\'42\"",
		"05/11":"+3\'42\"",
		"05/12":"+3\'42\"",
		"05/13":"+3\'42\"",
		"05/14":"+3\'41\"",
		"05/15":"+3\'39\"",
		"05/16":"+3\'37\"",
		"05/17":"+3\'34\"",
		"05/18":"+3\'31\"",
		"05/19":"+3\'27\"",
		"05/20":"+3\'23\"",
		"05/21":"+3\'18\"",
		"05/22":"+3\'13\"",
		"05/23":"+3\'07\"",
		"05/24":"+3\'01\"",
		"05/25":"+2\'54\"",
		"05/26":"+2\'47\"",
		"05/27":"+2\'39\"",
		"05/28":"+2\'31\"",
		"05/29":"+2\'22\"",
		"05/30":"+2\'13\"",
		"05/31":"+2\'04\"",
		"06/01":"+1\'54\"",
		"06/02":"+1\'44\"",
		"06/03":"+1\'34\"",
		"06/04":"+1\'23\"",
		"06/05":"+1\'12\"",
		"06/06":"+1\'00\"",
		"06/07":"+0\'48\"",
		"06/08":"+0\'36\"",
		"06/09":"+0\'24\"",
		"06/10":"+0\'12\"",
		"06/11":"+0\'01\"",
		"06/12":"+0\'14\"",
		"06/13":"+0\'39\"",
		"06/14":"+0\'52\"",
		"06/15":"-1\'05\"",
		"06/16":"-1\'18\"",
		"06/17":"-1\'31\"",
		"06/18":"-1\'45\"",
		"06/19":"-1\'57\"",
		"06/20":"-2\'10\"",
		"06/21":"-2\'23\"",
		"06/22":"-2\'36\"",
		"06/23":"-2\'48\"",
		"06/24":"-3\'01\"",
		"06/25":"-3\'13\"",
		"06/26":"-3\'25\"",
		"06/27":"-3\'37\"",
		"06/28":"-3\'49\"",
		"06/29":"-4\'00\"",
		"06/30":"-4\'11\"",
		"07/01":"-4\'22\"",
		"07/02":"-4\'33\"",
		"07/03":"-4\'43\"",
		"07/04":"-4\'53\"",
		"07/05":"-5\'02\"",
		"07/06":"-5\'11\"",
		"07/07":"-5\'20\"",
		"07/08":"-5\'28\"",
		"07/09":"-5\'36\"",
		"07/10":"-5\'43\"",
		"07/11":"-5\'50\"",
		"07/12":"-5\'56\"",
		"07/13":"-6\'02\"",
		"07/14":"-6\'08\"",
		"07/15":"-6\'12\"",
		"07/16":"-6\'16\"",
		"07/17":"-6\'20\"",
		"07/18":"-6\'23\"",
		"07/19":"-6\'25\"",
		"07/20":"-6\'27\"",
		"07/21":"-6\'29\"",
		"07/22":"-6\'29\"",
		"07/23":"-6\'29\"",
		"07/24":"-6\'29\"",
		"07/25":"-6\'28\"",
		"07/26":"-6\'26\"",
		"07/27":"-6\'24\"",
		"07/28":"-6\'21\"",
		"07/29":"-6\'17\"",
		"07/30":"-6\'13\"",
		"07/31":"-6\'08\"",
		"08/01":"-6\'03\"",
		"08/02":"-5\'57\"",
		"08/03":"-5\'51\"",
		"08/04":"-5\'44\"",
		"08/05":"-5\'36\"",
		"08/06":"-5\'28\"",
		"08/07":"-5\'19\"",
		"08/08":"-5\'10\"",
		"08/09":"-5\'00\"",
		"08/10":"-4\'50\"",
		"08/11":"-4\'39\"",
		"08/12":"-4\'27\"",
		"08/13":"-4\'15\"",
		"08/14":"-4\'02\"",
		"08/15":"-3\'49\"",
		"08/16":"-3\'36\"",
		"08/17":"-3\'21\"",
		"08/18":"-3\'07\"",
		"08/19":"-2\'51\"",
		"08/20":"-2\'36\"",
		"08/21":"-2\'20\"",
		"08/22":"-2\'03\"",
		"08/23":"-1\'47\"",
		"08/24":"-1\'29\"",
		"08/25":"-1\'12\"",
		"08/26":"+0\'54\"",
		"08/27":"+0\'35\"",
		"08/28":"+0\'17\"",
		"08/29":"+0\'02\"",
		"08/30":"+0\'21\"",
		"08/31":"+0\'41\"",
		"09/01":"+1\'00\"",
		"09/02":"+1\'20\"",
		"09/03":"+1\'40\"",
		"09/04":"+2\'01\"",
		"09/05":"+2\'21\"",
		"09/06":"+2\'42\"",
		"09/07":"+3\'03\"",
		"09/08":"+3\'03\"",
		"09/09":"+3\'24\"",
		"09/10":"+3\'45\"",
		"09/11":"+4\'06\"",
		"09/12":"+4\'27\"",
		"09/13":"+4\'48\"",
		"09/14":"+5\'10\"",
		"09/15":"+5\'31\"",
		"09/16":"+5\'53\"",
		"09/17":"+6\'14\"",
		"09/18":"+6\'35\"",
		"09/19":"+6\'57\"",
		"09/20":"+7\'18\"",
		"09/21":"+7\'39\"",
		"09/22":"+8\'00\"",
		"09/23":"+8\'21\"",
		"09/24":"+8\'42\"",
		"09/25":"+9\'02\"",
		"09/26":"+9\'22\"",
		"09/27":"+9\'42\"",
		"09/28":"+10\'02\"",
		"09/29":"+10\'21\"",
		"09/30":"+10\'40\"",
		"10/01":"+10\'59\"",
		"10/02":"+11\'18\"",
		"10/03":"+11\'36\"",
		"10/04":"+11\'36\"",
		"10/05":"+11\'53\"",
		"10/06":"+12\'11\"",
		"10/07":"+12\'28\"",
		"10/08":"+12\'44\"",
		"10/09":"+12\'60\"",
		"10/10":"+13\'16\"",
		"10/11":"+13\'16\"",
		"10/12":"+13\'31\"",
		"10/13":"+13\'45\"",
		"10/14":"+13\'59\"",
		"10/15":"+14\'13\"",
		"10/16":"+14\'26\"",
		"10/17":"+14\'38\"",
		"10/18":"+14\'50\"",
		"10/19":"+15\'01\"",
		"10/20":"+15\'12\"",
		"10/21":"+15\'21\"",
		"10/22":"+15\'31\"",
		"10/23":"+15\'40\"",
		"10/24":"+15\'48\"",
		"10/25":"+15\'55\"",
		"10/26":"+16\'01\"",
		"10/27":"+16\'07\"",
		"10/28":"+16\'12\"",
		"10/29":"+16\'16\"",
		"10/30":"+16\'20\"",
		"10/31":"+16\'22\"",
		"11/01":"+16\'24\"",
		"11/02":"+16\'25\"",
		"11/03":"+16\'25\"",
		"11/04":"+16\'24\"",
		"11/05":"+16\'23\"",
		"11/06":"+16\'21\"",
		"11/07":"+16\'17\"",
		"11/08":"+16\'13\"",
		"11/09":"+16\'09\"",
		"11/10":"+16\'03\"",
		"11/11":"+15\'56\"",
		"11/12":"+15\'49\"",
		"11/13":"+15\'41\"",
		"11/14":"+15\'32\"",
		"11/15":"+15\'22\"",
		"11/16":"+15\'11\"",
		"11/17":"+14\'60\"",
		"11/18":"+14\'47\"",
		"11/19":"+14\'34\"",
		"11/20":"+14\'20\"",
		"11/21":"+14\'06\"",
		"11/22":"+13\'50\"",
		"11/23":"+13\'34\"",
		"11/24":"+13\'17\"",
		"11/25":"+12\'59\"",
		"11/26":"+12\'40\"",
		"11/27":"+12\'21\"",
		"11/28":"+12\'01\"",
		"11/29":"+11\'40\"",
		"11/30":"+11\'18\"",
		"12/01":"+10\'56\"",
		"12/02":"+10\'33\"",
		"12/03":"+10\'09\"",
		"12/04":"+9\'45\"",
		"12/05":"+9\'21\"",
		"12/06":"+8\'55\"",
		"12/07":"+8\'29\"",
		"12/08":"+8\'03\"",
		"12/09":"+7\'36\"",
		"12/10":"+7\'09\"",
		"12/11":"+6\'42\"",
		"12/12":"+6\'14\"",
		"12/13":"+5\'46\"",
		"12/14":"+5\'17\"",
		"12/15":"+4\'48\"",
		"12/16":"+4\'19\"",
		"12/17":"+3\'50\"",
		"12/18":"+3\'21\"",
		"12/19":"+2\'51\"",
		"12/20":"+2\'22\"",
		"12/21":"+1\'52\"",
		"12/22":"+1\'22\"",
		"12/23":"+0\'52\"",
		"12/24":"+0\'23\"",
		"12/25":"+0\'07\"",
		"12/26":"+0\'37\"",
		"12/27":"-1\'06\"",
		"12/28":"-1\'36\"",
		"12/29":"-2\'05\"",
		"12/30":"-2\'34\"",
		"12/31":"-3\'03\"",
		}
</script>
<!--  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>-->

</html>
